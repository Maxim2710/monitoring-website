# API для мониторинга сайтов

## Описание

Этот проект представляет собой простой API, построенный с использованием **Spring Boot**, который предоставляет сервисы для мониторинга доступности сайтов. Основная функциональность включает проверку доступности одного сайта, а также нескольких сайтов одновременно, с возможностью настройки числа попыток и таймаутов для повышения надежности при реальном использовании.

### Ключевые особенности:
- Проверка доступности сайта по заданному URL.
- Повторные попытки подключения в случае неудачи.
- Проверка нескольких сайтов одновременно с настройками числа попыток и таймаута.
- Возврат времени отклика и сообщений об ошибках в случае неудачи подключения.

---

## Используемые технологии
- **Java 17**
- **Spring Boot**: Для создания бэкенд-приложения.
- **RestTemplate**: Для выполнения HTTP-запросов к внешним сайтам.
- **Lombok**: Для сокращения количества шаблонного кода.
- **ExecutorService**: Для параллельной обработки нескольких проверок сайтов.

---

## Настройка проекта

### Необходимые инструменты
- **Java 17** или выше.
- **Maven** (для сборки проекта).

### Клонирование репозитория

```bash
git clone <URL>
```

### Сборка и запуск

1. **Перейдите в директорию проекта**:

   ```bash
   cd monitoring-website
   ```

2. **Запуск приложения**:

   Если вы используете **Maven**:

   ```bash
   mvn spring-boot:run
   ```

3. Сервер будет работать на порту `8080` по умолчанию. Вы можете получить доступ к API по адресу `http://localhost:8080`.

---

## Эндпоинты API

### 1. Проверка доступности одного сайта

**POST** `/api/monitor/check`

Этот эндпоинт проверяет, доступен ли сайт по указанному URL. Также измеряется время отклика.

#### Пример тела запроса:

```json
{
  "url": "https://example.com",
  "timeout": 5000,
  "retries": 3
}
```

- `url`: URL сайта для проверки.
- `timeout`: Таймаут для каждого HTTP-запроса в миллисекундах.
- `retries`: Количество попыток в случае неудачи подключения.

#### Пример ответа:

```json
{
  "url": "https://example.com",
  "isAvailable": true,
  "responseTime": 1234,
  "message": "Website is available."
}
```

- `url`: Проверенный URL.
- `isAvailable`: Булево значение, указывающее на доступность сайта.
- `responseTime`: Время отклика (в миллисекундах), если сайт доступен.
- `message`: Сообщение с дополнительной информацией о статусе.

### 2. Проверка нескольких сайтов одновременно

**POST** `/api/monitor/check-multiple`

Этот эндпоинт проверяет доступность нескольких сайтов одновременно и возвращает их статус.

#### Пример тела запроса:

```json
{
  "urls": ["https://example1.com", "https://example2.com"],
  "timeout": 5000,
  "retries": 3
}
```

- `urls`: Список URL-ов для проверки.
- `timeout`: Таймаут для каждого HTTP-запроса в миллисекундах.
- `retries`: Количество попыток в случае неудачи подключения.

#### Пример ответа:

```json
[
  {
    "url": "https://example1.com",
    "isAvailable": true,
    "responseTime": 1456,
    "message": "Website is available."
  },
  {
    "url": "https://example2.com",
    "isAvailable": false,
    "responseTime": 0,
    "message": "Failed to connect after 3 attempts."
  }
]
```

---

## Как это работает

1. **Валидация URL**: Прежде чем пытаться проверить сайт, URL проверяется на корректность (он должен начинаться с `http://` или `https://`).

2. **Проверка одного сайта**:
    - Выполняется **GET** запрос к указанному URL.
    - Если сайт доступен, измеряется время отклика, и статус возвращается.
    - Если подключение не удается, выполняются повторные попытки до указанного числа.

3. **Проверка нескольких сайтов**:
    - Для нескольких URL используется **параллельная обработка** с помощью потоков, что ускоряет процесс проверки нескольких сайтов.
    - Каждый сайт проверяется в отдельном потоке, а результаты собираются и возвращаются.

---

## Пример

### Проверка одного сайта:

Запрос:

```bash
curl -X POST http://localhost:8080/api/monitor/check -H "Content-Type: application/json" -d '{"url": "https://google.com", "timeout": 5000, "retries": 3}'
```

Ответ:

```json
{
  "url": "https://google.com",
  "isAvailable": true,
  "responseTime": 210,
  "message": "Website is available."
}
```

### Проверка нескольких сайтов:

Запрос:

```bash
curl -X POST http://localhost:8080/api/monitor/check-multiple -H "Content-Type: application/json" -d '{"urls": ["https://google.com", "https://example.com"], "timeout": 5000, "retries": 3}'
```

Ответ:

```json
[
  {
    "url": "https://google.com",
    "isAvailable": true,
    "responseTime": 212,
    "message": "Website is available."
  },
  {
    "url": "https://example.com",
    "isAvailable": false,
    "responseTime": 0,
    "message": "Failed to connect after 3 attempts."
  }
]
```

---

## Устранение неполадок

- **Тайм-ауты подключения**: Убедитесь, что указанные URL доступны с сервера, на котором запущено приложение.
- **Неверный формат URL**: Проверьте, чтобы URL начинался с `http://` или `https://`.

